# ğŸ“Š Struttura dei Workflow Scientifici per SM-CPTD

Questo documento descrive le strutture DAG corrette dei 4 workflow scientifici usati nel paper SM-CPTD.

## ğŸŒŠ 1. CyberShake Workflow

**Dominio**: Analisi del rischio sismico (Southern California Earthquake Center)

### Struttura DAG:
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ PreCVM   â”‚  (1 task)
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
         â–¼       â–¼       â–¼       â–¼       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” ... (N sites)
    â”‚GenCVM_1â”‚ â”‚GenCVM_2â”‚ 
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚          â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â–¼       â–¼  â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚SGT_1aâ”‚ â”‚SGT_1bâ”‚ â”‚SGT_2aâ”‚ â”‚SGT_2bâ”‚  (2 per site)
â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜
   â”‚        â”‚        â”‚        â”‚
   â–¼        â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ PSA  â”‚ â”‚ PSA  â”‚ â”‚ PSA  â”‚ â”‚ PSA  â”‚  (M filters per SGT)
â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜        â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ZipPSA_1â”‚      â”‚ZipPSA_2â”‚  (1 per site)
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚PostProcessâ”‚  (1 task)
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Formula task totali:
```
N_tasks = 1 (PreCVM) + N (GenCVM) + 2N (SGT) + 2NM (PSA) + N (ZipPSA) + 1 (PostProcess)
        = 2 + N(4 + 2M)

Per 50 task con M=2: N â‰ˆ 6 siti
```

### Parametri tipici paper:
- Sites (N): 5-20
- SGT variations: 2
- PSA filters (M): 2-5
- **Caratteristica**: Alta parallelismo nel livello PSA

---

## ğŸ”­ 2. Montage Workflow

**Dominio**: Creazione mosaici astronomici (NASA/IPAC)

### Struttura DAG:
```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚mProject_1â”‚ â”‚mProject_2â”‚ â”‚mProject_Nâ”‚  (N immagini)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚
         â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚mDiffFit_1â”‚ â”‚mDiffFit_2â”‚ â”‚mDiffFit_Nâ”‚  (N tasks)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ mConcatFit â”‚  (1 task - bottleneck)
               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  mBgModel  â”‚  (1 task)
               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚mBackground1â”‚ â”‚mBackground2â”‚ â”‚mBackgroundNâ”‚  (N tasks)
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   mAdd   â”‚  (1 task)
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ mShrink  â”‚  (1 task)
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Formula task totali:
```
N_tasks = N (mProject) + N (mDiffFit) + 1 (mConcatFit) + 1 (mBgModel) 
        + N (mBackground) + 1 (mAdd) + 1 (mShrink)
        = 3N + 4

Per 50 task: N â‰ˆ 15 immagini
```

### Parametri tipici paper:
- Immagini (N): 10-100
- **Caratteristica**: Struttura "diamante" con bottleneck centrali

---

## ğŸŒŒ 3. LIGO Workflow

**Dominio**: Rilevamento onde gravitazionali

### Struttura DAG:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CondData_Hâ”‚ â”‚CondData_Lâ”‚ â”‚CondData_Vâ”‚  (3 detector: Hanford, Livingston, Virgo)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚
     â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Segment_1, Segment_2, ... S     â”‚  (S segmenti per detector)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Template1â”‚ â”‚Template2â”‚ â”‚TemplateTâ”‚  (T template per segmento)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚Coincidence â”‚  (Analisi coincidenze)
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Injection  â”‚  (Test iniezione segnale)
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  PostProc  â”‚  (Post-elaborazione)
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Formula task totali:
```
N_tasks = 3 (CondData) + 3S (Segment) + 3ST (Template) + 1 (Coincidence) 
        + 1 (Injection) + 1 (PostProc)
        = 6 + 3S(1 + T)

Per 50 task con T=3: S â‰ˆ 4 segmenti
```

### Parametri tipici paper:
- Detector: 3 (fisso)
- Segmenti (S): 2-10
- Template (T): 3-10
- **Caratteristica**: Alto fan-out nel matching

---

## ğŸ§¬ 4. Epigenomics Workflow

**Dominio**: Analisi genomica (mappatura epigenetica)

### Struttura DAG:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastQC_1â”‚ â”‚ FastQC_2â”‚ â”‚ FastQC_Nâ”‚  (N campioni)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Trimming1â”‚ â”‚Trimming2â”‚ â”‚TrimmingNâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Align_1 â”‚ â”‚ Align_2 â”‚ â”‚ Align_N â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sort_1  â”‚ â”‚ Sort_2  â”‚ â”‚ Sort_N  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dedup_1 â”‚ â”‚ Dedup_2 â”‚ â”‚ Dedup_N â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚
   â”Œâ”€â”´â”€â”       â”Œâ”€â”´â”€â”       â”Œâ”€â”´â”€â”
   â–¼   â–¼       â–¼   â–¼       â–¼   â–¼
â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”
â”‚Peakâ”‚â”‚Peakâ”‚ â”‚Peakâ”‚â”‚Peakâ”‚ â”‚Peakâ”‚â”‚Peakâ”‚  (A tipi analisi per campione)
â””â”€â”¬â”€â”€â”˜â””â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”€â”˜â””â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”€â”˜â””â”€â”¬â”€â”€â”˜
  â””â”€â”€â”¬â”€â”€â”˜      â””â”€â”€â”¬â”€â”€â”˜      â””â”€â”€â”¬â”€â”€â”˜
     â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Annotate1â”‚ â”‚Annotate2â”‚ â”‚AnnotateNâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ DiffAnalys â”‚
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
        â–¼       â–¼       â–¼
    â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
    â”‚Viz_1â”‚ â”‚Viz_2â”‚ â”‚Viz_Aâ”‚  (A visualizzazioni)
    â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚FinalReportâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Formula task totali:
```
N_tasks = N (FastQC) + N (Trim) + N (Align) + N (Sort) + N (Dedup)
        + NA (Peak) + N (Annotate) + 1 (DiffAnalysis) + A (Viz) + 1 (Report)
        = N(6 + A) + A + 2

Per 50 task con A=3: N â‰ˆ 5 campioni
```

### Parametri tipici paper:
- Campioni (N): 4-20
- Tipi analisi (A): 2-5
- **Caratteristica**: Pipeline lineare con fan-out/fan-in

---

## ğŸ“ˆ Confronto Strutture

| Workflow | Tipo Struttura | Parallelismo Max | Bottleneck | ProfonditÃ  |
|----------|---------------|------------------|------------|------------|
| CyberShake | Fan-out/Fan-in | Alto (PSA) | ZipPSA | 6 livelli |
| Montage | Diamante | Medio | mConcatFit, mBgModel | 7 livelli |
| LIGO | Fan-out estremo | Molto Alto (Template) | Coincidence | 6 livelli |
| Epigenomics | Pipeline parallele | Medio | DiffAnalysis | 10 livelli |

---

## ğŸ”§ Generazione con il Nostro Codice

```bash
# Genera tutti i workflow con 50 task e 5 VM
cd algorithms
java JavaCCRAnalysis montage
java JavaCCRAnalysis cybershake
java JavaCCRAnalysis ligo
java JavaCCRAnalysis epigenomics

# I file vengono salvati in ../data/
# - task.csv: lista task con size
# - dag.csv: dipendenze
# - vm.csv: matrice bandwidth
# - processing_capacity.csv: capacitÃ  VM
```

## ğŸ“š Riferimenti

1. **CyberShake**: Graves et al., "CyberShake: A Physics-Based Seismic Hazard Model", SCEC
2. **Montage**: Berriman et al., "Montage: An Astronomical Image Mosaic Service", ASP Conference
3. **LIGO**: Abbott et al., "LIGO Scientific Collaboration", Physical Review Letters
4. **Epigenomics**: ENCODE Project Consortium, "An integrated encyclopedia of DNA elements"
5. **SM-CPTD Paper**: Springer Journal of Supercomputing (s11227-021-03742-3)
